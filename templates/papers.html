{% extends "layout.html" %}
{% block content %}

    <div class="container p-3">
        from {{ older_days }} to  {{ recent_days }} days ago 
        <a href="?recent_days=1&older_days=0">
           today
        </a>
        <a href="?recent_days={{ (recent_days-1) | urlencode}}&older_days={{ (older_days-1) | urlencode  }}">
            future
        </a>
        <a href="?recent_days={{ (recent_days+1) | urlencode}}&older_days={{ (older_days+1) | urlencode  }}">
            past
        </a>
    </div>


  <table class="table table-striped table-sm">

    <thead class="thead">
     <tr>
       <th>URI</th>
       <th>Title</th>
       <th>Facts</th>
       <th>Computable as Workflow</th>
       <th>Related Workflows</th>
       <th>Actions</th>
     </tr>
    </thead>

    {% for pid, p in papers %}
        <tr>
            <td>
                {% for l in p['paper:location'] %}
                    <a href="{{ l }}">{{ pid }}</a>
                {% endfor %}
                <br>
                {% for l in p['paper:timestamp'] %}
                    {{ l | timestamp2isot }}
                {% endfor %}
            </td>
            <td>
                {% for t in p['paper:title'] %}
                    {{ t }}
                {% endfor %}
            </td>
            <td> 
                {% set rowid = pid.replace(":","-").replace(".", "-") %}

                <div id="accordion">
                    <button class="btn btn-link" data-toggle="collapse" data-target="#collapse{{ rowid }}">
                        {% for k,v in p.items() %}
                        {% if k not in ['@id', 'paper:location', 'paper:title'] and 'times' not in k and 'updated' not in k%}
                                {{ k.split(":")[1] }}
                        {% endif %}
                        {% endfor %}
                    </button>

                    <div id="collapse{{ rowid }}" class="collapse" data-parent="#accordion">
                        <small>
                        <ol>
                        {% for k,v in p.items() %}
                        {% if k not in ['@id', 'paper:location', 'paper:title']%}
                            <li>
                                {{ k }}: {{ v }}
                            </li>
                        {% endif %}
                        {% endfor %}
                        </ol>
                        </small>
                    </div>
                </div>

            </td>

            <td>
                fetch-workflow-{{ pid }}
            </td>
            
            <td>
            </td>

            <td>
                <div class="span2">
                    <button type="button" class="btn btn-sm btn-block btn-primary" 
                                          onclick="window.open('care?paper-uri={{ pid | urlencode }}','_blank');">Care</button>
                    <button type="button" class="btn btn-sm btn-block btn-danger" 
                                          onclick="$.get('expire?uri=', function (data) {alert(data); })">Uncare</button>
                </div>
            </td>
        </tr>
    {% endfor %}

  </table>
{% endblock %}
