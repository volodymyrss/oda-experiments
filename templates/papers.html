{% extends "layout.html" %}
{% block content %}

    <div class="container p-3">
        {% set span_days = recent_days - older_days %}

        {{ span_days }} from {{ older_days }} to  {{ recent_days }} days ago 
        <a href="?recent_days=1&older_days=0&rdf_filters={{ rdf_filters | urlencode}}">
           today
        </a>

        <a href="?recent_days=7&older_days=0&rdf_filters={{ rdf_filters | urlencode}}">
           last week
        </a>

        <a href="?recent_days={{ (recent_days-span_days) | urlencode}}&older_days={{ (older_days-span_days) | urlencode  }}&rdf_filters={{ rdf_filters | urlencode}}">
            future
        </a>

        <a href="?recent_days={{ (recent_days+span_days) | urlencode}}&older_days={{ (older_days+span_days) | urlencode  }}&rdf_filters={{ rdf_filters | urlencode}}">
            past
        </a>

        <a href="?recent_days={{ recent_days | urlencode}}&older_days={{ older_days | urlencode  }}&rdf_filters={{ '?paper paper:source "GCN"' | urlencode}}">
           GCNs 
        </a>

        <a href="?recent_days={{ recent_days | urlencode}}&older_days={{ older_days | urlencode  }}&rdf_filters={{ '?paper paper:source "arXiv"' | urlencode}}">
           arXiv
        </a>
        
        <a href="?recent_days={{ recent_days | urlencode}}&older_days={{ older_days | urlencode  }}&rdf_filters={{ '?paper paper:source "ATel"' | urlencode}}">
           ATel 
        </a>

        &nbsp;
           <!-- Navbar Search -->
            <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0" action="">
              <div class="input-group">
                <input type="hidden" name="recent_days" value="{{ recent_days }}">
                <input type="hidden" name="older_days" value="{{ older_days }}">
                <input type="text" class="form-control" placeholder="Search for..." aria-label="Search" aria-describedby="basic-addon2" name="rdf_filters" value="{{ rdf_filters }}">
                <div class="input-group-append">
                  <button class="btn btn-primary" type="submit">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
            </form>

    </div>


  <table class="table table-striped table-sm">

    <thead class="thead">
     <tr>
       <th>URI</th>
       <th>Title</th>
       <th>Facts</th>
       <th>Computable as Workflow</th>
       <th>Related Workflows</th>
       <th>Actions</th>
     </tr>
    </thead>

    {% for pid, p in papers %}
        <tr>
            <td>
                {% for l in p['paper:location'] %}
                    <a href="{{ l }}">{{ pid }}</a>
                {% endfor %}
                <br>
                {% for l in p['paper:timestamp'] %}
                    {{ l | timestamp2isot }}
                {% endfor %}
            </td>
            <td>
                {% for t in p['paper:title'] %}
                    {{ t }}
                {% endfor %}
            </td>
            <td> 
                {% set rowid = pid.replace(":","-").replace(".", "-") %}

                <div id="accordion">
                    <button class="btn btn-link" data-toggle="collapse" data-target="#collapse{{ rowid }}">
                        {% for k,v in p.items() %}
                        {% if k not in ['@id', 'paper:location', 'paper:title'] and 'times' not in k and 'updated' not in k%}
                                {{ k.split(":")[1] }}
                        {% endif %}
                        {% endfor %}
                    </button>

                    <div id="collapse{{ rowid }}" class="collapse" data-parent="#accordion">
                        <small>
                        <ol>
                        {% for k,v in p.items() %}
                        {% if k not in ['@id', 'paper:location', 'paper:title']%}
                            <li>
                                {{ k }}: {{ v }}
                            </li>
                        {% endif %}
                        {% endfor %}
                        </ol>
                        </small>
                    </div>
                </div>

            </td>

            <td>
                fetch-workflow-{{ pid }}
            </td>
            
            <td>
            </td>

            <td>
                <div class="span2">
                    <button type="button" class="btn btn-sm btn-block btn-primary" 
                                          onclick="window.open('care?paper-uri={{ pid | urlencode }}','_blank');">Care</button>
                    <button type="button" class="btn btn-sm btn-block btn-danger" 
                                          onclick="$.get('expire?uri=', function (data) {alert(data); })">Uncare</button>
                </div>
            </td>
        </tr>
    {% endfor %}

  </table>
{% endblock %}
